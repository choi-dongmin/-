# Permission 

- 리눅스는 다계정 운영체제이고 그로 인해 타 계정의 파일에 무단으로 접근하는것을 방지하기 위해 접근 권한 보호를 제공한다.

![Permission](https://user-images.githubusercontent.com/57117748/167590708-de9a2024-7116-489e-b801-85d07b342a4f.jpg)

```
r: read = 읽기,복사(파일) 또는 목록 보기(dir) 
w: write = 수정,이동,삭제(파일) 또는 생성,삭제(dir) 
x: execute = 실행(파일) 또는 접근(dir)


-rw-r--r-- => 1. - / 2. rw- / 3. r-- / 4. r--

1. - : 파일을 뜻한다. (dir = d)
2. rw- : 사용자 접근 권한을 뜻한다.
3. r-- : 그룹 접근 권한을 뜻한다.
4. r-- : 기타사용자 접근 권한

```

- /etc/shadow 파일은 접근권한이 ------- 이기 떄문에 user 모드에서 읽는것이 불허된다. 

![접근권한](https://user-images.githubusercontent.com/57117748/167593191-e5906851-585c-4e09-9b53-8e69d9eaa1d5.jpg)



## 접근 권한의 변경 (chmod)
- 심볼 모드와 숫자 모드가 있지만 주로 숫자모드(8진법)을 사용한다.

```
1. rwx / 2. rwx/ 3. rwx

각각의 권한에 r:4(읽기), w:2(쓰기), x:1(실헹)


ex) -/rw-/r--/r-- = 4+2 / 4 / 4
ex) -/rw-/r--/--- = 4+2 / 4 / 0


```
![chmod](https://user-images.githubusercontent.com/57117748/167595186-3dee50b0-d853-4061-9780-9a04baed3534.png)


- 문제

```
default : touch file 644 = -rw-r--r--

1.기타 사용자에게 실행 권한을 부여한다
2.그룹과 기타 사용자의 실행 권한을 제거한다 
3.모두에게 실행 권한을 부여한다 
4.소유자에게 쓰기 권한을 부여하고 그룹의 쓰기 권한은 제거한다 
5.소유자의 권한만 남기고 나머지 사용자의 권한은 모두 제거

1. 645 = -rw-r--r-x
2. 644 = -rw-r--r--
3. 755 = -rwxr-xr-x
4. 644 = -rw-r--r--
5. 700 = -rwx------
```

## 기본 접근 권한
- 디렉토리 파일은 777의 기본값을 가지고 파일은 666의 기본값을 가진다.
- umask : 파일이나 디렉토리 생성시 부여하지 않을 권한을 지정하는것

- root umask default : 022 / user mask default : 002
- umask [숫자모드] 입력으로 변경이 가능하며 기본적으로 자신의 계정에만 설정된고 재부팅시에 기본 값으로 되돌아 간다
- 만약 초기 설정을 하고 싶가면 초기 실행파일에 지정해 놓는다. 
```
umask 007
```
![화면 캡처 2022-05-10 122907_LI](https://user-images.githubusercontent.com/57117748/167602484-45b48743-4768-4e81-8413-8132f9644f6c.jpg)



* 기본값과 umask 를 빼서 기본 접근 권한이 만들어 진다

```
root 
1. diractory
777 - 022 = 755 = drwxr-xr-x

2. file 
666 - 022 = 644 = -rw-r--r--


user
1. diractory
777 - 002 = 775 = drwxrwxr-x

2. file 
666 - 002 = 664 = -rw-rw-r--
``` 

## 확장 퍼미션 (특수접근권한)
- setuid
- setgid
- stickybit


1. setuid
	- 사용자가 해당파일을 실행 시 현 사용자가 아닌 "해당 파일의 소유자"로 실행 
	- chmod 4xxx 의 명령으로 setuid 부여
	- ex) /bin/us

```
chmod 4715

-rws--xr-x

1. 사용자 권한에 실행 권한이 x 가 아닌 s 로 표시
```


2. setgid

	- 사용자가 해당파일을 실행 시 현 사용자가 아닌 "해당 파일의 그룹"으로 실행
	- chmod 2xxx 의 명령으로 setgid 부여

```
chmod 2771

-rwsrws--x

1. 그룹 권한에 실행 권한이 x 가 아닌 s 로 표시
```

* 만약 setuid, setgid 를 동시에 부여하고 싶다면 6xxx 으로 부여
* 특수 접근 권한의 경우 보안상 매우 중요하다.


![setuid, setgid](https://user-images.githubusercontent.com/57117748/167606481-ca09e06b-0feb-4ae8-a9be-f6c703b7390b.png)


- /bin/passwd 는 사용자의 비밀번호를 변경하는 민감한 파일이기 때문에 setuid를 통해 다른 사용자가 접근하더라도 root 로 진입을 하게 된다.
- 만약 그 설정을 변경하고 관리자가 아닌 다른 사용자가 실행한다면 결과는 어떨까?


- root에서 /bin/passwd setid 를 chmod 755 를 통해 변경
![화면 캡처 2022-05-10 142851_LI](https://user-images.githubusercontent.com/57117748/167607739-2d186557-1608-47c9-8f30-2e7b93d089cd.jpg)


- user 에서 비밀번호 변경 시도 및 실패

![화면 캡처 2022-05-10 142920_LI](https://user-images.githubusercontent.com/57117748/167607942-3b65a779-c9b5-4358-b660-e24459e26078.jpg)




3. stickybit
	- 오직 디렉토리에서 부여 가능하면 쓰기와 연관이 있다.
	- stickybit 이 설정된 디렉토리는 해당 파일 소유자와 root 계정만이 삭제를 할 수 있다.
	- chmod 1xxx 로 부여한다.
	- ex) 게시판 삭제 시스템, /etc/tmp(임시 파일 디렉터)
	* 보통 stickybit 디렉토리는 공유 디렉토리에 설정 


![화면 캡처 2022-05-10 144028_LI](https://user-images.githubusercontent.com/57117748/167608082-7782ce0c-66db-4762-85cf-c4921c570332.jpg)


- 정리

```
setuid : 오직 파일에만 설정
stickybit : 오직 디렉토리에만 설정
setgid : 둘 다 설정 그러나 디렉토리에 설정한 해당 디렉토리에서 생성한 파일의 소유 그룹은 해당 디렉토리의 소유그룹으로 지정. 
```

- 명령으로 확장 퍼미션 찾기

```
1. setuid file 찾기
find / -perm -4000 

2. setgid file 찾기
find / -perm -2000 

3. stickybit dir 찾기
find / -perm -1000
```

# 디스크
- 파티셔닝
- 파일 시스템
- 마운트

## 하드디스크 구조

![hard disk](https://sites.google.com/site/iebitwiki/_/rsrc/1343729284108/hardware/secondary-storage/hard-disk-drive/platter.png)

- 하드 디스크의 최소 단위는 512byte 이며 '섹터'라고 일컫는다.
- 섹터들이 모여 원을 이뤄 -> '트랙'
- 트랙이 모여 -> '실린더'
- 실린더가 모여 -> '파티션'
- 파티션 -> '디스크'

* MBR (Master Boot Record)
	- 섹터들 중 가장 첫번째로 하드디스크에서 부팅할 때 현재 디스크에 파티션이 몇개인지 부팅 프로그램의 위치는 어디인지 등을 기록
	- 총 4개의 파티션,  2TB를 가질수 있다.
	- Extension(마지막 파티션을 또 분할) 을 한다면 파티션의 개수를 늘릴 수 있다.

* GPT (GUID Partition Table)
	- 그 외 섹터들 즉 물리적인 하드 디스크에 대한 파테션 테이블 레이아웃의 표준이다.
	- 128개의 파티션으로 분리 가능

## 디스크 연결 Interface 방식
- E-ide -> SATA -> msata , NVMe :데스크톱
- SCSI -> SA-SCSI(SAS) : 서버

* 기본적으로 서버는 SCSI 를 주로 사용한다 SCSI 는 핫플러깅, 자체 디스크 컨트롤러를 통한 CPU 부담 절감 등이 가능하다.

# 리눅스 파일 시스템
- 파일과 디렉토리 집합을 구조적으로 관리하는 체계
- 어떤 구조를 구성해 파일이나 디렉토리를 관리하느냐에 따라 다양한 형식의 파일 시스템이 존재
- 저널링 : 디스크가 변화내용을 기록하는것 최근의 디스크들은 저널링을 대부분 지원한다.

windows : nfts 
Linux : ext4, xfs


- 리눅스에서 지원하는 다른 디스크 기반 파일 시스템
```
iso9660 : CD-ROM, DVD의 표준 파일 시스템으로 읽기 전용으로 사용된다.
nfs : network file system으로 원격 서버의 디스크를 연결할 때 사용된다.
ufs : Unix file system으로 유닉스 표준 파일 시스템이다.
vfat : 윈도우95,98,NT를 지원하기 위한 파일 시스템
ntfs : 윈도우 NTFS를 지원하기 위한 파일 시스템
```

- 특수 용도 가상 파일 시스템
```
swap : swap 영역을 관리하기 위한 swap 파일 시스템이다. (swap:메모리를 사용하다 부족해 하드 디스크에서 빌려쓰는것.)
tmpfs : tmp(temporary file system)으로 메모리에 임시 파일을 저장하기 위한 파일 시스템이며, 시스템이 재시작 할 때마다 기존 내용이 없어진다. Ex /tmp
proc : proc 파일 시스템으로 /proc 디렉토리. 현재 커널의 상태를 나타내는 파일
ramfs : 램디스크를 지원하는 파일 시스템이다.
root : root file system으로 / 디렉토리이다.
```

## 리눅스의 모든 파일 시스템의 기본 개념
- 파일은 모드 inode 로 관리 된다.
- 특수 파일을 통해 장치에 접근 할 수있다. Ex) $ /dev
* 리눅스의 모든것은 다 파일로 표현한다.

## ext4 파일의 시스템의 구조 
- 효율적으로 디스크를 사용하기 위해 저장 장치를 논리적인 블록의 집합(블록 그룹)으로 구분
- 데이터 블록에는 데이터가 저장
- 마치 다단계의 구조를 가진다.
	* inode 비트 맵 : 파일 정보를 저장
	* 데이터 블록 비트맵 : 실제의 데이터를 저장
- 직접 블록에 데이터 주소가 있고 파일이 크면 다단계 형식으로 나눠 주소를 입력한다.
![ext4 file system](https://i.stack.imgur.com/IN09u.gif)

1. 블록 그룹 0 : 파일 시스템의 첫 번째 블록 그룹으로 특별하게 그룹 0 패딩과 슈퍼블록, 그룹 디스크립터를 가지고 있다. 
	- 그룹 디스크립터 : 그룹 메타 데이터
	- 슈퍼 블록 : 핵심 메타 데이터 
2. 블록 그룹 a : 파일 시스템에서 첫 번째 블록 그룹이 아닌 블록 그룹으로 그룹 0 패딩이 없으나 슈퍼블록과 그룹 디스크립터에 대한 복사본을 가지고 있다.  
3. 블록 그룹 b : 파일 시스템에서 첫 번째 블록 그룹이 아닌 블록 그룹으로 그룹 0 패딩, 슈퍼블록, 그룹 디스크립터가 없고 바로 데이터 블록 비트맵으로 시작한다.

## 파일 시스템 마운트
- 파일 시스템을 디렉토리 계층 구조의 특정 디렉토리와 연결하는것.
- 마운트 포인트 : 디렉토리 계층 구조에서 파일 시스템이 연결되는 디렉토리를 마운트 포인트라 한다.

![화면 캡처 2022-05-10 222405](https://user-images.githubusercontent.com/57117748/167638816-976f8218-2171-4255-8ffb-695b79d96a04.png)

